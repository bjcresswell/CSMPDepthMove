---
title: "Exploratory data analysis - using animals to measure temperature vs depth"
aauthor: "Ben Cresswell"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
 html_document:
    code_folding: show
    collapse: no
    df_print: paged
    fig_caption: yes
    fig_height: 4
    fig_width: 4
    highlight: textmate
    theme: spacelab
    toc: yes
    toc_float: yes
editor_options: 
  chunk_output_type: inline
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Load required packages
```{r packages, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
library(tidyverse)
```

# Housekeeping
```{r warning=FALSE}
#rm(list=ls()) # Clear out environment if necessary
```

# Load shark and teleost T/P data
```{r}
load(file = "../data/Rdata/shark_tp_data.Rdata")
```

# Need to get depth and temp on the same row
The data as they stand have temperature and depth on seperate rows as they are communicated to VR2Ws separately. Further, they also don't always have a corresponding measurement (i.e. a temp ping at XX:XX time doesn't always have a depth ping at XX:X2 and vice-versa). So we need a hacky workaround and will try mean hourly depth against mean hourly temperature. Will introduce noise, but the only thing I can think to do right now.

## Will have to summarise depth and temp which means they'll have to go in separate dfs and then get joined back together again.

### Temperature
```{r}
shark_temptime <- shark_tp_data %>% 
  select(transmitter_id, station_name_long, detection_timestamp, Temp, Depth) %>% 
  mutate(hour = hour(detection_timestamp),
         date = date(detection_timestamp),
         date_hour = paste(date, hour)) %>% 
  group_by(transmitter_id, station_name_long, date_hour, date) %>% 
  filter(!is.na(Temp)) %>% 
  summarise(mean_Temp = mean(Temp))#,
```

### Depth
```{r}
shark_depthtime <- shark_tp_data %>% 
  select(transmitter_id, station_name_long, detection_timestamp, Temp, Depth) %>% 
  mutate(hour = hour(detection_timestamp),
         date = date(detection_timestamp),
         date_hour = paste(date, hour)) %>% 
  group_by(transmitter_id, station_name_long, date_hour, date) %>% 
  filter(!is.na(Depth)) %>% 
  summarise(mean_Depth = mean(Depth))
```

### Rejoin
```{r}
tempdepth <- 
  full_join(shark_temptime, shark_depthtime)
head(tempdepth)
```

### Split out by station name
There will also be noise introduced by the fact that these detections are over 13 VR2Ws, so we'll need to investigate separately
```{r}
tempdepth %>% 
  ggplot() +
  geom_point(aes(x = mean_Temp, y = mean_Depth)) +
  scale_y_reverse() +
  facet_wrap(~station_name_long)
```
Clearly also seasonal noise!!


# Try the first summer only
```{r}
tempdepth %>% 
  filter(date > "2021-11-30",
         date < "2022-01-30") %>% 
  ggplot() +
  geom_point(aes(x = mean_Temp, y = mean_Depth)) +
  scale_y_reverse() +
  facet_wrap(~station_name_long)
```

# Second summer only
```{r}
tempdepth %>% 
  filter(date > "2022-03-30",
         date < "2023-01-30") %>% 
  ggplot() +
  geom_point(aes(x = mean_Temp, y = mean_Depth)) +
  scale_y_reverse() +
  facet_wrap(~station_name_long)
```


Still very noisy, however some observations:
- No observations of 



