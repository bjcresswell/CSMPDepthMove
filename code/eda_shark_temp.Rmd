---
title: "Exploratory data analysis - temperature"
aauthor: "Ben Cresswell"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
 html_document:
    code_folding: show
    collapse: no
    df_print: paged
    fig_caption: yes
    fig_height: 4
    fig_width: 4
    highlight: textmate
    theme: spacelab
    toc: yes
    toc_float: yes
editor_options: 
  chunk_output_type: inline
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Load required packages
```{r packages, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
library(tidyverse)
```

# Housekeeping
```{r warning=FALSE}
#rm(list=ls()) # Clear out environment if necessary
```

# Load shark T/P data
```{r}
load(file = "../data/Rdata/shark_tp_data.Rdata")
shark_tp_data
```

# Temp overview - by individual
```{r shark_t_eda1, fig.width=16, fig.height=6}
shark_tp_data %>% 
  #filter(station_name %in% c("CS-O1", "CS-O2")) %>% 
  ggplot() +
  geom_point(aes(x = detection_timestamp, y = Temp)) +
  facet_wrap(~ transmitter_id)
```

# Temp overview - by receiver station
```{r shark_t_eda1, fig.width=16, fig.height=6}
shark_tp_data %>% 
  #filter(station_name %in% c("CS-O1", "CS-O2")) %>% 
  ggplot() +
  geom_point(aes(x = detection_timestamp, y = Temp)) +
  facet_wrap(~ station_name_long)

shark_tp_data %>% 
  #filter(station_name %in% c("CS-O1", "CS-O2")) %>% 
  ggplot() +
  geom_point(aes(x = detection_timestamp, y = Temp)) +
  facet_wrap(~ station_name)
```
A lot of noise in there!
Only a few observations from Lagoon 1 and none from Lagoon 2 - these unlikely to skew data

Looks like all individual sharks have data for the whole period


# Shark temps - daily summary
```{r}
shark_daily_temps <- 
  shark_tp_data %>% 
  mutate(date = date(detection_timestamp),
         year_week = str_c(str_sub(isoyear(date), 3, 4),  "/", formatC(isoweek(date), format = "f", digits = 0, width = 2, flag = "0"))) %>% 
  filter(!is.na(Temp)) %>% 
  group_by(date) %>% 
  summarise(daily_max_temp = max(Temp),
            daily_min_temp = min(Temp),
            daily_mean_temp = mean(Temp))
shark_daily_temps
save(shark_daily_temps, file = "../data/Rdata/shark_daily_temps.Rdata")
```


# Plot along side SST

# Load SST data
```{r}
source(knitr::purl("../code/wrangling_SSTdata.Rmd", quiet=TRUE))
```

## Trim SST to length of deployment used here
```{r}
SST_comb3 <- 
  SST_comb3 %>% 
  filter(date < as.Date("2022-11-01"))
```

## Plot
```{r}
shark_daily_temps_plot <- 
shark_daily_temps %>% 
ggplot() +
  #geom_point(aes(x = date, y = daily_max_temp), colour = "red") +
  geom_line(aes(x = date, y = daily_max_temp), colour = "red") +
  #geom_point(aes(x = date, y = daily_min_temp), colour = "blue") +
  geom_line(aes(x = date, y = daily_min_temp), colour = "blue") +
  #geom_point(aes(x = date, y = daily_mean_temp), colour = "grey40") +
  geom_line(aes(x = date, y = daily_mean_temp), colour = "grey40") +
  #geom_point(aes(x = date, y = roll_mean), data = SST_comb3, colour = "black") +
  geom_line(aes(x = date, y = roll_mean), data = SST_comb3, colour = "black") +
  scale_x_date(date_breaks = "1 months", date_labels = '%Y-%m') +
  theme_csmp +
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5)) +
  #annotate("text", x = as.Date("2021-11-01"), y = 30.5, label = "a") +
  xlab("Month of year") + 
  ylab("Temp (Â°C)")
shark_daily_temps_plot
```

```{r}
ggsave(filename = "../output/shark_daily_temps_plot.png", plot = shark_daily_temps_plot, width = 16, height = 10, units = "cm")
```


# Shark temps - weekly summary
```{r}
shark_weekly_temps <- 
  shark_tp_data %>% 
  mutate(date = date(detection_timestamp),
         year_week = str_c(str_sub(isoyear(date), 3, 4),  "/", formatC(isoweek(date), format = "f", digits = 0, width = 2, flag = "0"))) %>% 
  filter(!is.na(Temp)) %>% 
  group_by(year_week) %>% 
  summarise(weekly_max_temp = max(Temp),
            weekly_min_temp = min(Temp),
            weekly_mean_temp = mean(Temp))

save(shark_weekly_temps, file = "../data/Rdata/shark_weekly_temps.Rdata")
```





