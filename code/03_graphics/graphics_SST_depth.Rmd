---
title: "Graphics"
author: "Ben Cresswell"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
 html_document:
    code_folding: show
    collapse: no
    df_print: paged
    fig_caption: yes
    fig_height: 70/25.4
    fig_width: 170/25.4
    highlight: textmate
    theme: spacelab
    toc: yes
    toc_float: yes
editor_options: 
  chunk_output_type: inline
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	include = TRUE,
	message = FALSE,
	warning = FALSE)
```


```{r include=FALSE}
source("code/packages.R")
#rm(list=ls()) # Clear out environment if necessary
```

# Plot depth time series with depth models
```{r fig.width = 170/25.4, fig.height = 130/25.4}

```


## Plot daily depths
```{r fig.width = 170/25.4, fig.height = 70/25.4}
shark_daily_depth_plot <- 
shark_daily_td %>%   
  ggplot() +
  geom_line(aes(x = date, y = daily_min_depth), colour = "grey50") +
  #geom_smooth(aes(x = date, y = daily_min_depth), colour = "blue",  method = "gam", formula = y ~ s(x, bs = 'cs')) + # method = "gam" implements mgcv
  geom_line(aes(x = date, y = daily_mean_depth), colour = "dodgerblue") +
  geom_smooth(aes(x = date, y = daily_mean_depth), colour = "dodgerblue",  method = "gam", formula = y ~ s(x, bs = 'cs')) +
  geom_line(aes(x = date, y = daily_max_depth), colour = "midnightblue") +
  geom_smooth(aes(x = date, y = daily_max_depth), colour = "midnightblue",  method = "gam", formula = y ~ s(x, bs = 'cs'), level = 0.95) +
  #geom_smooth(aes(x = date, y = daily_max_depth), colour = "red") + # Basic smooth, rather than gam
  theme_minimal() +
  scale_y_reverse() +
  scale_x_date(date_breaks = "1 months", date_labels = '%b') +
  theme(axis.text.x = element_text(angle = 0)) +
  #theme(axis.text.x = element_blank()) +
  #theme(axis.title.x = element_blank()) +
  #theme(axis.ticks.x = element_blank()) +
  xlab("\nMonth of year (2021 - 2022)") +
  ylab("Depth (m below sea level)")

shark_daily_depth_plot
```
# Combine with SST plot
```{r fig.width = 170/25.4, fig.height = 30/25.4}
SST_plot_plain <- 
  shark_daily_td %>% 
  ggplot() +
  geom_line(aes(x = date, y = SST), colour = "grey15", lwd = 0.5) +
  scale_x_date(date_breaks = "1 months", date_labels = '%Y-%m') +
  ylab("SST (Â°C)") +
  theme_minimal() +
  theme(axis.title.y = element_text(size = 9, hjust = 0.1),
        axis.text.x = element_blank(),
        axis.title.x = element_blank(),
        axis.ticks.x = element_blank())
        #panel.background = element_rect(fill = "transparent", colour = "black", linewidth = 1),
        #panel.border = element_rect(fill = "transparent", colour = "black", linewidth = 1),

SST_plot_plain
```

```{r fig.width = 170/25.4, fig.height = 100/25.4}
shark_dep_timeseries_fig <- cowplot::plot_grid(SST_plot_plain, shark_daily_depth_plot, nrow = 2, labels = c('A'), label_size = 9, rel_heights = c(0.5, 1.5), align = "v") +
    theme(plot.background = element_rect(color = "black")) 

shark_dep_timeseries_fig
```


```{r}
ggsave(filename = "output/shark_dep_timeseries_fig.pdf", plot = shark_dep_timeseries_fig, width = 170, height = 100, device = cairo_pdf, units = "mm", dpi = 300)
```


# Model results
## Cowplot
```{r fig.height = 56/25.4, fig.width = 168/25.4}
shark_dep_model_fig <- cowplot::plot_grid(mod4_plot, mod5_plot, mod6_plot, nrow = 1, labels = c('B', 'C', 'D'), label_size = 9, align = "h") +
  theme(plot.background = element_rect(color = "black")) +
  annotate("text", x = 0.09, y = 0.9, label = expression("R"^2*"=0.47"), hjust = 0, size = 3) +
  annotate("text", x = 0.41, y = 0.9, label = expression("R"^2*"=0.64"), hjust = 0, size = 3) +
  annotate("text", x = 0.73, y = 0.9, label = expression("R"^2*"=0.001"), hjust = 0, size = 3)
shark_dep_model_fig
```

## Patchwork
```{r fig.height = 56/25.4, fig.width = 168/25.4}
shark_dep_model_fig <- mod4_plot + mod5_plot + mod6_plot + plot_layout(ncol = 3, nrow = 1) +
    theme(plot.background = element_rect(color = "black")) 
shark_dep_model_fig
```


## Save
```{r}
ggsave(filename = "output/shark_dep_model_fig.pdf", plot = shark_dep_model_fig, width = 170, height = 56, device = cairo_pdf, units = "mm", dpi = 300)
```






